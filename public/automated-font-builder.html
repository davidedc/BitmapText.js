<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automated Font Asset Builder</title>
  <style>
    body {
      padding: 20px;
      margin: 0;
      background-color: #f0f0f0;
      font-family: monospace;
      font-size: 14px;
    }

    canvas {
      font-smooth: never;
      -webkit-font-smoothing: none;
      -moz-osx-font-smoothing: none;
    }
  </style>
</head>

<body>
  <h1>Automated Font Asset Builder</h1>
  <p>This page is controlled by Playwright automation.</p>
  <p id="status">Initializing...</p>
</body>

<!-- Core libraries -->
<script src="../lib/jszip.min.js"></script>
<script src="../lib/FileSaver.min.js"></script>
<script src="../lib/QOIEncode.js"></script>

<!-- Utilities -->
<script src="../src/utils/timing.js"></script>

<!-- Global variables needed by glyph rendering -->
<script>
  // drawCrisply controls whether canvases are attached to DOM for CSS font-smoothing
  // Set to true for crisp rendering (requires DOM attachment)
  let drawCrisply = true;

  // truncateMetrics controls whether metrics are truncated to integer values
  // Set to true for more compact metrics (default behavior)
  let truncateMetrics = true;
</script>

<!-- Runtime classes -->
<script src="../src/runtime/StatusCode.js"></script>
<script src="../src/runtime/FontProperties.js"></script>
<script src="../src/runtime/TextProperties.js"></script>
<script src="../src/runtime/FontMetrics.js"></script>
<script src="../src/runtime/InterpolatedFontMetrics.js"></script>
<script src="../src/runtime/AtlasPositioning.js"></script>
<script src="../src/runtime/AtlasImage.js"></script>
<script src="../src/runtime/AtlasData.js"></script>
<script src="../src/runtime/TightAtlasReconstructor.js"></script>
<script src="../src/runtime/AtlasDataStore.js"></script>
<script src="../src/runtime/FontMetricsStore.js"></script>
<script src="../src/runtime/FontLoaderBase.js"></script>
<script src="../src/platform/FontLoader-browser.js"></script>
<script src="../src/runtime/BitmapText.js"></script>

<!-- Builder (FAB) classes -->
<script src="../src/builder/FontPropertiesFAB.js"></script>
<script src="../src/builder/FontMetricsFAB.js"></script>
<script src="../src/builder/AtlasPositioningFAB.js"></script>
<script src="../src/builder/AtlasImageFAB.js"></script>
<script src="../src/builder/AtlasDataStoreFAB.js"></script>
<script src="../src/builder/FontMetricsStoreFAB.js"></script>
<script src="../src/builder/BitmapTextFAB.js"></script>
<script src="../src/builder/GlyphFAB.js"></script>

<script src="../src/builder/AtlasBuilder.js"></script>
<script src="../src/builder/KerningCalculator.js"></script>
<script src="../src/builder/MetricsMinifier.js"></script>
<script src="../src/builder/MetricsExpander.js"></script>

<!-- Atlas generation utilities -->
<script src="../src/utils/AtlasCellDimensions.js"></script>
<script src="../src/utils/canvas-extensions.js"></script>
<script src="../src/utils/HashStore.js"></script>
<script src="../src/utils/deep-equal.js"></script>

<!-- Specs system -->
<script src="../src/specs/Specs.js"></script>
<script src="../src/specs/SpecsParser.js"></script>
<script src="../src/specs/default-specs.js"></script>

<!-- Glyph creation -->
<script src="../src/builder/create-glyphs.js"></script>

<!-- Font set generator -->
<script src="../src/utils/FontSetGenerator.js"></script>

<!-- Export functionality -->
<script src="../tools/export-font-data.js"></script>

<!-- Automation orchestration -->
<script src="../src/automation/automated-builder.js"></script>

<script>
  // Update status display
  const statusEl = document.getElementById('status');
  if (statusEl) {
    statusEl.textContent = 'Ready for automation commands';
  }

  console.log('='.repeat(60));
  console.log('Automated Font Asset Builder - Ready');
  console.log('='.repeat(60));
  console.log('All dependencies loaded successfully');
  console.log('Waiting for Playwright to provide font specification...');

  // Explicitly expose BitmapText on window for Playwright access
  // In WebKit, class declarations in global scope may not be enumerable on window
  // page.evaluate() from Playwright needs explicit window reference
  window.BitmapText = BitmapText;
  window.BitmapTextFAB = BitmapTextFAB;
  window.AtlasDataStoreFAB = AtlasDataStoreFAB;
  window.FontMetricsStoreFAB = FontMetricsStoreFAB;
  window.GlyphFAB = GlyphFAB;
  window.FontSetGenerator = FontSetGenerator;

  // Signal that all scripts are loaded and BitmapText is fully initialized
  // This is checked by automated-font-builder.js after page reloads to ensure
  // static fields like BitmapText.CHARACTER_SET are ready before font generation
  window.bitmapTextReady = true;
  console.log('✅ BitmapText static fields initialized:', {
    CHARACTER_SET: !!BitmapText.CHARACTER_SET,
    SYMBOL_CHARACTERS_STRING: !!BitmapText.SYMBOL_CHARACTERS_STRING,
    characterSetLength: BitmapText.CHARACTER_SET?.length
  });
  console.log('✅ Classes exposed on window:', {
    BitmapText: typeof window.BitmapText,
    CHARACTER_SET: !!window.BitmapText?.CHARACTER_SET,
    SYMBOL_CHARACTERS_STRING: !!window.BitmapText?.SYMBOL_CHARACTERS_STRING
  });
</script>

</html>