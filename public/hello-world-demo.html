<!DOCTYPE html>
<html lang="">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BitmapText.js - Hello World Demo</title>
  <style>
    body {
      padding: 20px;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }
    
    h1 {
      margin-bottom: 20px;
      color: #333;
    }
    
    canvas {
      border: 1px solid #ccc;
      background: white;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <h1>BitmapText.js - Minimal Hello World Demo</h1>
  <p>This demo shows "Hello World" rendered using pre-generated bitmap fonts for pixel-perfect consistency.</p>
  <canvas id="demo-canvas" width="300" height="100"></canvas>

  <!-- Essential dependencies -->
  <!-- Status reporting constants and helpers (must load first) -->
  <script src="../src/runtime/StatusCode.js"></script>
  <!-- FontProperties class for font configuration -->
  <script src="../src/runtime/FontProperties.js"></script>
  <!-- TextProperties class for text rendering configuration -->
  <script src="../src/runtime/TextProperties.js"></script>
  <!-- FontMetrics domain object for encapsulating font metrics data -->
  <script src="../src/runtime/FontMetrics.js"></script>
  <!-- Default character set constant (required by MetricsExpander) -->
  <script src="../src/runtime/CHARACTER_SET.js"></script>
  <!-- Expander utility to unpack minified font metrics data (depends on FontMetrics) -->
  <script src="../src/builder/MetricsExpander.js"></script>
  <!-- Atlas positioning domain object for encapsulating atlas positioning data -->
  <script src="../src/runtime/AtlasPositioning.js"></script>
  <!-- Atlas image domain object for encapsulating atlas images -->
  <script src="../src/runtime/AtlasImage.js"></script>
  <!-- Atlas data object combining image and positioning -->
  <script src="../src/runtime/AtlasData.js"></script>
  <!-- Atlas reconstruction utilities for image data extraction -->
  <script src="../src/builder/AtlasReconstructionUtils.js"></script>
  <!-- Atlas cell dimensions utility for calculating atlas cell dimensions -->
  <script src="../src/utils/AtlasCellDimensions.js"></script>
  <!-- Tight atlas reconstructor for converting Atlas → Tight Atlas at runtime -->
  <script src="../src/runtime/TightAtlasReconstructor.js"></script>
  <!-- Storage classes for atlas and metrics data -->
  <script src="../src/runtime/AtlasDataStore.js"></script>
  <script src="../src/runtime/FontMetricsStore.js"></script>
  <!-- Font loader classes for loading font assets -->
  <script src="../src/runtime/FontLoaderBase.js"></script>
  <script src="../src/platform/FontLoader-browser.js"></script>
  <!-- Main bitmap text rendering engine (static class) -->
  <script src="../src/runtime/BitmapText.js"></script>

  <script>
    // Font properties for Arial normal normal 19 with pixel density 1
    // Pixel density 1.0 = standard display (non-Retina)
    // For HiDPI displays, use window.devicePixelRatio (see README.md "Understanding Coordinate Systems")
    const fontProperties = new FontProperties(1, "Arial", "normal", "normal", 19); // pixelDensity, fontFamily, fontStyle, fontWeight, fontSize

    // Text properties for rendering configuration
    const textProperties = new TextProperties({
      isKerningEnabled: true,      // Enable kerning for better text rendering
      textBaseline: 'bottom',      // BitmapText uses bottom baseline positioning
      textAlign: 'left',           // Standard left alignment
      textColor: '#000000'         // Black color
    });

    // Canvas setup
    const canvas = document.getElementById('demo-canvas');
    const ctx = canvas.getContext('2d');

    // Configure font directory (required since we're in public/ subdirectory)
    BitmapText.setFontDirectory('../font-assets/');

    // Load font using static BitmapText API
    const isFileProtocol = window.location.href.includes("file://");

    // Load font and render when ready
    BitmapText.loadFont(fontProperties.idString, {
      isFileProtocol,
      onProgress: (loaded, total) => console.log(`Loaded ${loaded} of ${total} files`)
    }).then(() => {
      renderHelloWorld();
    });

    function renderHelloWorld() {
      // Clear canvas with white background
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // IMPORTANT: BitmapText ignores context transforms
      // Coordinates (10, 50) are ABSOLUTE from canvas origin (0,0)
      // Any ctx.scale(), ctx.translate(), ctx.rotate() are ignored

      // Draw "Hello World" using bitmap text - API returns status info
      const result = BitmapText.drawTextFromAtlas(
        ctx,
        "Hello World",
        10,  // x position in CSS pixels (absolute from origin)
        50,  // y position in CSS pixels (absolute from origin)
        fontProperties,
        textProperties  // text rendering properties including color and kerning
      );

      // Check rendering result and status
      if (result.rendered) {
        if (result.status.code === StatusCode.SUCCESS) {
          console.log('✅ Hello World rendered successfully!');
        } else {
          console.warn('⚠️ Hello World rendered with issues:');
          console.warn('Status:', getStatusDescription(result.status));

          if (result.status.placeholdersUsed) {
            console.warn('Some glyphs were rendered as placeholder rectangles');
          }

          if (result.status.missingAtlasChars) {
            console.warn('Missing atlas data for characters:', [...result.status.missingAtlasChars].join(''));
          }
        }
      } else {
        console.error('❌ Failed to render Hello World:');
        console.error('Status:', getStatusDescription(result.status));

        if (result.status.missingChars) {
          console.error('Missing metrics for characters:', [...result.status.missingChars].join(''));
        }
      }
    }
  </script>
</body>

</html>