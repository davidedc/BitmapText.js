<!DOCTYPE html>
<html lang="">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BitmapText.js - Hello World Demo</title>
  <style>
    body {
      padding: 20px;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }
    
    h1 {
      margin-bottom: 20px;
      color: #333;
    }
    
    canvas {
      border: 1px solid #ccc;
      background: white;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <h1>BitmapText.js - Minimal Hello World Demo</h1>
  <p>This demo shows "Hello World" rendered using pre-generated bitmap fonts for pixel-perfect consistency.</p>
  <canvas id="demo-canvas" width="300" height="100"></canvas>

  <!-- Essential dependencies -->
  <!-- Status reporting constants and helpers (must load first) -->
  <script src="../src/core/StatusCode.js"></script>
  <!-- FontProperties class for font configuration -->
  <script src="../src/core/FontProperties.js"></script>
  <!-- TextProperties class for text rendering configuration -->
  <script src="../src/core/TextProperties.js"></script>
  <!-- FontMetrics domain object for encapsulating font metrics data -->
  <script src="../src/core/FontMetrics.js"></script>
  <!-- Expander utility to unpack minified font metrics data (depends on FontMetrics) -->
  <script src="../src/minification/MetricsExpander.js"></script>
  <!-- Data store for atlas images -->
  <script src="../src/core/AtlasStore.js"></script>
  <!-- Data store for font metrics, kerning, and positioning -->
  <script src="../src/core/FontMetricsStore.js"></script>
  <!-- Main bitmap text rendering engine -->
  <script src="../src/core/BitmapText.js"></script>
  <!-- Font loading utilities -->
  <script src="../src/core/FontLoaderConfig.js"></script>
  <script src="../src/core/FontLoader.js"></script>

  <script>
    // Font properties for Arial normal normal 19 with pixel density 1
    const fontProperties = new FontProperties(1, "Arial", "normal", "normal", 19); // pixelDensity, fontFamily, fontStyle, fontWeight, fontSize

    // Text properties for rendering configuration
    const textProperties = new TextProperties({
      isKerningEnabled: true,      // Enable kerning for better text rendering
      textBaseline: 'bottom',      // BitmapText uses bottom baseline positioning
      textAlign: 'left',           // Standard left alignment
      textColor: '#000000'         // Black color
    });

    // Initialize bitmap text system
    const atlasStore = new AtlasStore();
    const fontMetricsStore = new FontMetricsStore();
    const bitmapText = new BitmapText(atlasStore, fontMetricsStore);

    // Canvas setup
    const canvas = document.getElementById('demo-canvas');
    const ctx = canvas.getContext('2d');

    // Load font using FontLoader (elegant single-font approach)
    const isFileProtocol = window.location.href.includes("file://");
    const fontLoader = new FontLoader(atlasStore, fontMetricsStore, (loaded, total) => {
      console.log(`Loaded ${loaded} of ${total} files`);
    });

    // Load font and render when ready
    fontLoader.loadFont(fontProperties.idString, isFileProtocol)
      .then(() => {
        renderHelloWorld();
      });

    function renderHelloWorld() {
      // Clear canvas with white background
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw "Hello World" using bitmap text - API returns status info
      const result = bitmapText.drawTextFromAtlas(
        ctx,
        "Hello World",
        10,  // x position
        50,  // y position
        fontProperties,
        textProperties  // text rendering properties including color and kerning
      );

      // Check rendering result and status
      if (result.rendered) {
        if (result.status.code === StatusCode.SUCCESS) {
          console.log('✅ Hello World rendered successfully!');
        } else {
          console.warn('⚠️ Hello World rendered with issues:');
          console.warn('Status:', getStatusDescription(result.status));

          if (result.status.placeholdersUsed) {
            console.warn('Some glyphs were rendered as placeholder rectangles');
          }

          if (result.status.missingAtlasChars) {
            console.warn('Missing atlas data for characters:', [...result.status.missingAtlasChars].join(''));
          }
        }
      } else {
        console.error('❌ Failed to render Hello World:');
        console.error('Status:', getStatusDescription(result.status));

        if (result.status.missingChars) {
          console.error('Missing metrics for characters:', [...result.status.missingChars].join(''));
        }
      }
    }
  </script>
</body>

</html>