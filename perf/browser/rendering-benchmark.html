<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BitmapText.js Performance Benchmark (Unbundled)</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>BitmapText.js Performance Benchmark</h1>
  <p class="subtitle">Unbundled Version - Progressive FPS Testing</p>

  <div id="controls">
    <button id="start-benchmark">Start Benchmark</button>
    <div id="status"></div>
  </div>

  <canvas id="benchmark-canvas" width="1200" height="800"></canvas>

  <div id="report"></div>

  <!-- Load BitmapText.js source files (unbundled) -->
  <!-- Critical: StatusCode MUST be loaded first -->
  <script src="../../src/runtime/StatusCode.js"></script>
  <script src="../../src/runtime/FontProperties.js"></script>
  <script src="../../src/runtime/TextProperties.js"></script>
  <script src="../../src/runtime/FontMetrics.js"></script>
  <script src="../../src/builder/MetricsExpander.js"></script>
  <script src="../../src/runtime/AtlasPositioning.js"></script>
  <script src="../../src/runtime/AtlasImage.js"></script>
  <script src="../../src/runtime/AtlasData.js"></script>
  <script src="../../src/builder/AtlasReconstructionUtils.js"></script>
  <script src="../../src/utils/AtlasCellDimensions.js"></script>
  <script src="../../src/runtime/TightAtlasReconstructor.js"></script>
  <script src="../../src/runtime/AtlasDataStore.js"></script>
  <script src="../../src/runtime/FontMetricsStore.js"></script>
  <script src="../../src/runtime/FontLoaderBase.js"></script>
  <script src="../../src/platform/FontLoader-browser.js"></script>
  <script src="../../src/runtime/BitmapText.js"></script>

  <!-- Load test data -->
  <script src="../../src/shared/test-data.js"></script>

  <!-- Load benchmark modules -->
  <script src="fps-tester.js"></script>
  <script src="benchmark-core.js"></script>
  <script src="report-generator.js"></script>

  <script>
    // Configure BitmapText
    BitmapText.setFontDirectory('../../font-assets/');

    // DOM elements
    const startButton = document.getElementById('start-benchmark');
    const statusDiv = document.getElementById('status');

    // Update status
    function updateStatus(message, type = 'active') {
      statusDiv.textContent = message;
      statusDiv.className = type;
    }

    // Run benchmark
    async function runBenchmark() {
      startButton.disabled = true;
      updateStatus('Initializing benchmark...', 'active');

      try {
        // Create benchmark instance
        const benchmark = new BenchmarkCore('benchmark-canvas', {
          fontFamily: 'Arial',
          fontStyle: 'normal',
          fontWeight: 'normal',
          fontSize: 19,
          pixelDensity: 1,
          testBlock: TEST_BLOCK_5_LINES,
          lineHeight: 25,
          targetFPS: 60,
          consecutiveFramesThreshold: 10,
          bundleType: 'unbundled'
        });

        // Progress callback
        const progressCallback = (progress) => {
          const messages = {
            'font-loading': 'â³ Loading font...',
            'bitmaptext-black': 'ðŸ”¤ Testing BitmapText (black text)...',
            'bitmaptext-colored': 'ðŸŽ¨ Testing BitmapText (colored text)...',
            'canvas-black': 'ðŸ“ Testing HTML5 Canvas (black text)...',
            'canvas-colored': 'ðŸ–Œï¸ Testing HTML5 Canvas (colored text)...',
            'complete': 'âœ… Benchmark complete!'
          };
          updateStatus(messages[progress.stage] || progress.message, 'active');
        };

        // Run all benchmarks
        const results = await benchmark.runAllBenchmarks(progressCallback);

        // Generate report
        updateStatus('âœ… Generating report...', 'complete');
        const reportGenerator = new ReportGenerator(results);
        reportGenerator.generate();

        updateStatus('âœ… Benchmark complete! Scroll down to see results.', 'complete');

      } catch (error) {
        console.error('Benchmark error:', error);
        updateStatus(`âŒ Error: ${error.message}`, 'active');
      } finally {
        startButton.disabled = false;
      }
    }

    // Event listener
    startButton.addEventListener('click', runBenchmark);

    // Auto-start on load (optional - comment out if not desired)
    // window.addEventListener('load', () => {
    //   setTimeout(runBenchmark, 500);
    // });
  </script>
</body>
</html>
